$(document).ready(function(t){var e=[],a=t.ajax({url:"/tasks",method:"GET",dataType:"JSON"});a.done(function(a){if(console.log(a),1==a.status){var n=Object.values(a.data);for(i=0;i<n.length;i++){var o=n[i],s=o.start_date.split("-"),r=o.end_date.split("-");e.push({title:o.name,start:new Date(s[0],s[1]-1,s[2]),end:new Date(r[0],r[1]-1,r[2]),allDay:!1,text:o.status,status:o.status.toLowerCase()})}e.sort(function(t,e){return+t.start-+e.start}),t("#holder").calendar({data:e})}}),a.fail(function(t,e){alert("Request failed: "+e)})});var $currentPopover=null;$(document).on("shown.bs.popover",function(t){var e=$(t.target);$currentPopover&&$currentPopover.get(0)!=e.get(0)&&$currentPopover.popover("toggle"),$currentPopover=e}).on("hidden.bs.popover",function(t){var e=$(t.target);$currentPopover&&$currentPopover.get(0)==e.get(0)&&($currentPopover=null)}),$.extend({quicktmpl:function(t){return new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split("{{").join("\t").replace(/((^|\}\})[^\t]*)'/g,"$1\r").replace(/\t:(.*?)\}\}/g,"',$1,'").split("\t").join("');").split("}}").join("p.push('").split("\r").join("\\'")+"');}return p.join('');")}}),$.extend(Date.prototype,{toDateCssClass:function(){return"_"+this.getFullYear()+"_"+(this.getMonth()+1)+"_"+this.getDate()},toDateInt:function(){return 32*(12*this.getFullYear()+this.getMonth())+this.getDate()},toTimeString:function(){var t=this.getHours(),e=this.getMinutes(),a=t>12?t-12:t,n=t>=12?" pm":" am";return 0===t&&0===e?"":e>0?a+":"+e+n:a+n}}),function(t){var e=t.quicktmpl(t("#tmpl").get(0).innerHTML);function a(a,n){function o(e,a){if(a.allDay)s(e,a);else{var o=t("<div/>",{class:"event "+a.status,text:a.title,title:a.title,"data-index":e}),r=a.start,l=a.end||r,d=a.start.toTimeString(),i=r.getHours(),u=".time-22-0",c=r.toDateInt(),p=n.date.toDateInt(),g=l.toDateInt();c>p||g<p||(d&&o.html("<strong>"+d+"</strong> "+o.html()),o.toggleClass("begin",c===p),o.toggleClass("end",g===p),i<6&&(u=".time-0-0"),i<22&&(u=".time-"+i+"-"+(r.getMinutes()<30?"0":"30")),t(u).append(o))}}function s(e,a){var o,s,r=t("<div/>",{class:"event "+a.status,text:a.title,title:a.title,"data-index":e}),l=new Date(a.start),d=l.toDateCssClass(),i=t("."+l.toDateCssClass()),u=t("<div/>",{class:"clear event",html:" "}),c=0,p=a.start.toTimeString(),g=a.end&&t("."+a.end.toDateCssClass()).length>0,h=new Date(l.getFullYear(),l.getMonth(),l.getDate()+40);if(r.toggleClass("all-day",!!a.allDay),p&&r.html("<strong>"+p+"</strong> "+r.html()),!a.end)return r.addClass("begin end"),void t("."+a.start.toDateCssClass()).append(r);for(;l<=a.end&&(i.length||g||n.date<h);){if(i.length){for(o=i.find(".event").length,c=Math.max(c,o),s=0;s<c-o;s++)i.append(u.clone());i.append(r.toggleClass("begin",d===a.start.toDateCssClass()).toggleClass("end",d===a.end.toDateCssClass())),(r=r.clone()).html(" ")}l.setDate(l.getDate()+1),d=l.toDateCssClass(),i=t("."+d)}}function r(){var r,l,d;a.html(e(n)),t("."+(new Date).toDateCssClass()).addClass("today"),n.data&&n.data.length&&("year"===n.mode?(r=n.data,l=n.date.getFullYear(),d=[0,0,0,0,0,0,0,0,0,0,0,0],t.each(r,function(t,e){e.start.getFullYear()===l&&d[e.start.getMonth()]++}),t.each(d,function(e,a){0!==a&&t(".month-"+e).append('<span class="badge">'+a+"</span>")})):"month"===n.mode||"week"===n.mode?t.each(n.data,s):t.each(n.data,o))}a.on("click",".js-cal-prev",function(){switch(n.mode){case"year":n.date.setFullYear(n.date.getFullYear()-1);break;case"month":n.date.setMonth(n.date.getMonth()-1);break;case"week":n.date.setDate(n.date.getDate()-7);break;case"day":n.date.setDate(n.date.getDate()-1)}r()}).on("click",".js-cal-next",function(){switch(n.mode){case"year":n.date.setFullYear(n.date.getFullYear()+1);break;case"month":n.date.setMonth(n.date.getMonth()+1);break;case"week":n.date.setDate(n.date.getDate()+7);break;case"day":n.date.setDate(n.date.getDate()+1)}r()}).on("click",".js-cal-option",function(){var e=t(this).data();e.date&&(e.date=new Date(e.date)),t.extend(n,e),r()}).on("click",".js-cal-years",function(){var e=t(this),a=e.data("popover"),o="",s=n.date.getFullYear()-2,r=s+5;if(a)return!0;for(;s<r;s++)o+='<button type="button" class="btn btn-default btn-lg btn-block js-cal-option" data-date="'+new Date(s,1,1).toISOString()+'" data-mode="year">'+s+"</button>";return e.popover({content:o,html:!0,placement:"top"}).popover("toggle"),!1}).on("click",".event",function(){var e,a,o=t(this),s=+o.attr("data-index");return!(!o.data("popover")&&!isNaN(s))||((a=(e=n.data[s]).start.toTimeString())&&e.end&&(a=a+" - "+e.end.toTimeString()),o.data("popover",!0),o.popover({content:"<p><strong>"+a+"</strong></p>"+e.text,html:!0,placement:"left"}).popover("toggle"),!1)}),r()}!function(t,e,n,o){e.extend({calendar:function(a){return e.extend(t,a)}}).fn.extend({calendar:function(n){return n=e.extend({},t,n),e(this).each(function(){a(e(this),n)})}})}({days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],date:new Date,daycss:["c-sunday","","","","","","c-saturday"],todayname:"Today",thismonthcss:"current",lastmonthcss:"outside",nextmonthcss:"outside",mode:"month",data:[]},jQuery,window,document)}(jQuery);